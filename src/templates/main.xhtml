<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
      PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:svg="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink">
<head>
<link type="text/css" rel="stylesheet" href="/static/picture.css"/>
<title>Game Listing Page</title>
<link type="text/css" rel="stylesheet" href="/static/GameListing.css"/>
<script src="/static/jquery-1.3.2.min.js" type="text/javascript"></script>
<script src="/static/event.js" type="text/javascript"></script>
<script src="/static/GameListing.js" type="text/javascript"></script>
<script type="text/javascript">//<![CDATA[

$(document).ready(function() {
	var now = new Date();
	var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
	var yesterday = today.addDays(-1);
	var sunday = today.addDays(-today.getDay());
	var lastsunday = sunday.addDays(-7);
	
	var gl = new GameListing("{{email}}", "{{gameListingUrl}}");
	gl.setLimit(25);
	
	var createdCol = new Column("Date.parseISO(this.data.dateTimeCreated)").setHeading("Created").setSortable(true).setSortField("dateTimeCreated").setDisplayBinding("this.data.dateTimeCreated ? Date.parseISO(this.data.dateTimeCreated).format() : 'ongoing'");
	createdCol.setGroups([lastsunday, sunday, yesterday, today]).setGroupNames(["More Than Two Weeks Ago", "Last Week", "This Week", "Yesterday", "Today"]);
	
	gl.addColumn(new Column("this.data.gameKey").setHeading("Game Key").setSortable(true).setSortField("gameKey"));
	gl.addColumn(new Column("this.data.owner").setHeading("Owner").setSortable(true).setSortField("owner").setDisplayBinding("this.data.owner ? this.data.owner.nickname : 'unknown'"));
	gl.addColumn(createdCol);
	gl.addColumn(new Column("this.data.dateTimeEnded").setHeading("Ended").setSortable(true).setSortField("dateTimeEnded").setDisplayBinding("this.data.dateTimeEnded ? Date.parseISO(this.data.dateTimeEnded).format() : 'ongoing'"));
	gl.addColumn(new PlayersColumn("this.data.players").setHeading("Players"));
	gl.addColumn(new ActionsColumn("this.data.players", "'/game/'+this.data.gameKey+'/join'", "'/game/'+this.data.gameKey+'/'").setHeading("Actions"));
	//gl.sortResults(2, GameListing.SortDir.Descending);
	//gl.addFilter("owner", "{{email}}");
	//gl.addFilter("owner", "test2@testdomain.com");
	createdCol.sort();
	gl.render(document.getElementById("gameListing"));
	
	$("#mygames").click(function() {
		gl.clearFilters();
		gl.clearSorts();
		gl.addFilter("user", "{{email}}");
		createdCol.sort();
	});
	$("#findgames").click(function() {
		gl.clearFilters();
		gl.clearSorts();
		createdCol.sort();
	});
});

//]]></script>

</head>
<body>


<div id="photoCell" class="bigPhoto">
  <img id="photo" src="{{imageUrl}}" alt="A picture of you"/>
</div>

<a href="/creategame">Create Game</a>
<a href="javascript:void(0)" id="mygames">My Games</a>
<a href="javascript:void(0)" id="findgames">Find Games</a>

<div id="gameListing">

</div>

</body>
</html>